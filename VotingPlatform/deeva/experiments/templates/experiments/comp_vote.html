{% extends "base.html" %}

{% load bootstrap3 %}
{% load staticfiles %}

{% block content %}
	
	<h1>Which individual looks...</h1>

	

	<div class="row">
		<!-- left individual -->
		<div class="col-sm-6 col-md-4 text-center order-xs-1 order-md-1">
		L: {{individual1.id}}
			<div class="img-thumbnail">
				{% for content_name in wizard.generation.experiment.content_list %}
					<img class="img-responsive img-vote" src="{% url 'experiments:send_individual_content' individual1.id content_name %}">
				{% endfor %}
			</div>
		</div>


		<!-- right individual -->
		<div class="col-sm-6 col-md-4 text-center order-xs-2 order-md-3">
		R: {{individual2.id}}
			<div class="img-thumbnail">
				{% for content_name in wizard.generation.experiment.content_list %}
					<img class="img-responsive img-vote" src="{% url 'experiments:send_individual_content' individual2.id content_name %}">
				{% endfor %}
			</div>
		</div>

		<!-- comparison vote panel -->


		

			
		<div class="col-sm-12 col-md-4 text-center order-xs-3 order-md-2">

			<form id=fake-form>
				{% for v in dependent_variables %}
				<div class="form-group">
					<label for="">...more {{v.name}} ({{v.id}})?</label><br>
					<div class="btn-group btn-group-toggle" data-toggle="buttons" data-variable="{{v.id}}">
						<label class="btn btn-secondary">
							<input type="radio" name="var{{v.id}}" data-vote="-1" autocomplete="off"> Left
						</label>
						<label class="btn btn-secondary">
							<input type="radio" name="var{{v.id}}" data-vote="0" autocomplete="off"> I don't know
						</label>
						<label class="btn btn-secondary">
							<input type="radio" name="var{{v.id}}" data-vote="1" autocomplete="off"> Right
						</label>
					</div>
				</div>
				{% endfor %}
			</form>

			{% block buttons %}
			<button id="fake-send-btn-click" type="button" class="btn btn-primary">
				<span class="fa fa-chevron-right"></span> {% block button_cnt %}Save &amp; Continue{% endblock %} 
			</button>
			<button id="fake-send-btn-spinner" type="button" class="btn btn-warning disabled d-none">
				<span class="fa fa-pulse fa-spinner"></span> {% block button_save %}Saving...{% endblock %} 
			</button>
			<button id="fake-send-btn-finished" type="button" class="btn btn-success disabled d-none">
				<span class="fa fa-check"></span> {% block button_load %}Saved! Loading next page...{% endblock %} 
			</button>
		{% endblock %}
			
		</div>

	


		
		
	</div>


	<form action="" method="post" autocomplete="off" id="real-form" hidden>
	    {% csrf_token %}
	    {{ formset.as_p }}
	    <input type="submit" value="Submit" />
	</form>
	

         
{% endblock %}



{% block scripts %}
<script>
	$("#fake-form")[0].reset(); //reset fake form on page load

	$("#fake-form").change(function() {
		//get total number of variables to fill and iterate through them
		var total_forms = $('input[name=form-TOTAL_FORMS]').val();


		for (i = 0; i < total_forms; i++) {

			//get variable id for current form
			vid = $('#id_form-'+i+'-variable').val();
			console.log(vid)

			//get selected vote from the fake form
			var vote = $('input[name=var'+vid+']:checked', '#fake-form').data('vote');

			//paste value in real form
			$('#id_form-'+i+'-vote').val(vote);
		} ;

	});


	$("#fake-send-btn-click").click(function() {
			var form = $("#real-form");
		    var url = form.attr('action');

		    $('#fake-send-btn-click').addClass("d-none");
		    $('#fake-send-btn-spinner').removeClass("d-none");

		    $.ajax({
		           type: "POST",
		           url: url,
		           data: form.serialize(),
		        }).done(function(data){
		        	if(data.success){
		        		//proceed
		        		$('#fake-send-btn-spinner').addClass("d-none");
		    			$('#fake-send-btn-finished').removeClass("d-none");
		    			window.location.href = "{% url 'experiments:vote' wizard.id %}";
		        	} else {
		        		//re-do form
		        		$('#fake-send-btn-spinner').addClass("d-none");
		    			$('#fake-send-btn-click').removeClass("d-none");
		    			alert("Please fill out the form before clicking on continue.");
		        	}
		        	
		        }).fail(function(jqXHR, textStatus, errorThrown){
		        	$('#fake-send-btn-spinner').addClass("d-none");
		    		$('#fake-send-btn-click').removeClass("d-none");
		        	alert(textStatus);
		        })
		});



</script>
{% endblock %}	


